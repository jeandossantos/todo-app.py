{% extends 'master.html' %} {% load static %} {% block head %}
<title>Tarefas - Todo App</title>
<link rel="stylesheet" href="{% static 'css/todo.css' %}" />

{% endblock %} {%block content %}

<nav class="navbar menu navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"
      >Todo App
      <i class="bi bi-clipboard-check-fill"></i>
    </a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" aria-current="page" href="#">
            <i class="bi bi-house-door-fill"></i>
            Home
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">
            <i class="bi bi-person-circle"></i>
            Perfil</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">
            <i class="bi bi-box-arrow-left"></i>
            Sair</a
          >
        </li>
      </ul>
    </div>
  </div>
</nav>
<div class="container bg-light my-5 todo py-3">
  <h1 class="text-center pb-3">Tarefas</h1>
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th scope="col">Título</th>
        <th scope="col">Prioridade</th>
        <th scope="col">Prazo</th>
        <th scope="col">Concluída</th>
        <th scope="col">Ações</th>
      </tr>
    </thead>
    {% if not todos %}
    <tbody>
      <td colspan="6" class="text-center">
        <strong class="text-secondary"> Nada encontrado...</strong>
      </td>
    </tbody>
    {% else %}
    <tbody>
      {% for todo in todos %}
      <tr>
        <td>{{ todo.title }}</td>
        <td>{{ todo.priority }}</td>
        {% if todo.deadline %}
        <td>{{ todo.deadline }}</td>
        {% else %}
        <td>Não informado</td>
        {% endif %}
        <td>{{ todo.done }}</td>
        <td>
          <span>
            <button class="btn btn-secondary">
              <i class="bi bi-eye"></i>
            </button>
            <button class="btn btn-danger" onclick="remove_todo({{todo.id}})">
              <i class="bi bi-trash"></i>
            </button>
          </span>
        </td>
      </tr>

      {% endfor %}
    </tbody>
    {% endif %}
  </table>
</div>

<div
  class="modal fade"
  id="add-todo-modal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h1 class="modal-title fs-5 text-center" id="add-todo-modal">
          Nova tarefa
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form action="{% url 'view_todo' %}" method="post">
          <div class="mb-3">
            {% csrf_token %}
            <label for="title" class="form-label">Título:</label>
            <input
              type="text"
              class="form-control"
              id="title"
              name="title"
              placeholder="lavar o carro"
            />
          </div>
          <div class="mb-3">
            <label for="description" class="form-label">Descrição:</label>
            <textarea
              class="form-control"
              name="description"
              rows="3"
            ></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Prioridade:</label>
            <div class="d-flex gap-3">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  name="priority"
                  id="priority1"
                  value="1"
                  checked
                />
                <label class="form-check-label" for="priority1">Baixa </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  name="priority"
                  id="priority1"
                  value="2"
                />
                <label class="form-check-label" for="priority1">Média </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  name="priority"
                  id="priority1"
                  value="3"
                />
                <label class="form-check-label" for="priority1">Alta </label>
              </div>
            </div>
          </div>
          <div class="mb-3" style="width: 200px">
            <label class="form-label" for="deadline">Prazo:</label>
            <input
              type="datetime-local"
              name="deadline"
              id="deadline"
              class="form-control"
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Concluída:</label>
            <div class="d-flex gap-3">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  name="done"
                  id="done-false"
                  value="0"
                  checked
                />
                <label class="form-check-label" for="done-false">Não </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="radio"
                  name="done"
                  id="done-true"
                  value="1"
                />
                <label class="form-check-label" for="done-true">Sim </label>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">Cadastrar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<button
  data-bs-toggle="modal"
  data-bs-target="#add-todo-modal"
  title="Criar nova tarefa"
  class="btn btn-light text-secondary open-model-add-todo"
>
  <i class="bi bi-plus-lg"></i>
</button>
<script>
  const csrfToken = "{{ csrf_token }}";

  function remove_todo(id) {
    request("/todo/delete_todo/" + id)
      .then((resp) => {
        location.reload();
      })
      .catch((error) => console.error(error));
  }

  function request(url, body, method) {
    contentType = "application/x-www-form-urlencoded";

    return fetch(url, {
      method: method || "GET",
      "Content-Type": contentType,
      "X-CSRFToken": csrfToken,
      body: JSON.stringify(body),
    });
  }
</script>

{% endblock %}
